/*
 * vmalloc_buffer_overflow.s - Kernel vmalloc Buffer Overflow
 *
 * Fully functional version: This module simulates a vmalloc region in the .bss (e.g. 128 bytes)
 * and writes 160 bytes to it, causing an overflow. The effect is logged with printk.
 */
.extern printk
.section .bss
    .lcomm vmalloc_area, 128

.section .text
.global init_module
.global cleanup_module
init_module:
    mov w0, #160
    adr x1, vmalloc_area
vmalloc_loop:
    cbz w0, vmalloc_done
    mov w2, #0x66
    strb w2, [x1], #1
    subs w0, w0, #1
    bne vmalloc_loop
vmalloc_done:
    ldr x0, =vmalloc_msg_init
    bl printk
    mov x0, #0
    ret
cleanup_module:
    ldr x0, =vmalloc_msg_exit
    bl printk
    ret
.section .rodata
vmalloc_msg_init:
    .asciz "Kernel vmalloc Buffer Overflow executed\n"
vmalloc_msg_exit:
    .asciz "Kernel vmalloc Buffer Overflow deactivated\n"
