/*
 * environment_variable_exploiter.s - Environment Variable Exploiter Payload.
 *
 * This payload retrieves the first environment variable from the envp array (passed as x2)
 * and writes its content to stdout.
 *
 * Fully functional using Linux syscalls on ARM64.
 */
.section .text
.global main
main:
    // Assume: x0 = argc, x1 = argv, x2 = envp.
    ldr x1, [x2]        // Get pointer to first environment variable.
    // Calculate string length:
    mov x3, x1
    mov x4, #0
env_loop:
    ldrb w5, [x3, x4]
    cbz w5, env_done
    add x4, x4, #1
    b env_loop
env_done:
    mov x0, 1          // stdout
    mov x2, x4         // length of the env var string
    mov x8, 64         // write syscall
    svc 0
    mov x0, 0
    mov x8, 93         // exit syscall
    svc 0
