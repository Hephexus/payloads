/*
 * double_free_exploit.s - Double Free Exploit POC.
 *
 * This exploit allocates memory using mmap and then calls munmap twice on the same region.
 *
 * WARNING: Double-free conditions can crash the process.
 */
 
.section .data
message:
    .asciz "Double Free Exploit Triggered!\n"

.section .text
.global main
main:
    mov x0, 0
    mov x1, #128
    mov x2, #3
    mov x3, #0x22
    mov x4, #-1
    mov x5, 0
    mov x8, #222
    svc 0
    mov x11, x0   // Save allocated pointer
    /* First unmap */
    mov x0, x11
    mov x1, #128
    mov x8, #215
    svc 0
    /* Second unmap on the same pointer */
    mov x0, x11
    mov x1, #128
    mov x8, #215
    svc 0
    mov x0, #1
    adr x1, message
    mov x2, #29
    mov x8, #64
    svc 0
    mov x0, #0
    mov x8, #93
    svc 0
